{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Parsley",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#keywords"
    },
    {
      "include": "#regex-literals"
    },
    {
      "include": "#datetime-literals"
    },
    {
      "include": "#duration-literals"
    },
    {
      "include": "#path-template-literals"
    },
    {
      "include": "#url-template-literals"
    },
    {
      "include": "#path-literals"
    },
    {
      "include": "#url-literals"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#template-literals"
    },
    {
      "include": "#numbers"
    },
    {
      "include": "#constants"
    },
    {
      "include": "#functions"
    },
    {
      "include": "#tags"
    },
    {
      "include": "#operators"
    },
    {
      "include": "#punctuation"
    }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.parsley",
          "match": "//.*$"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.parsley",
          "match": "\\b(if|else|return|for|in)\\b"
        },
        {
          "name": "keyword.other.parsley",
          "match": "\\b(let|fn|as)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.parsley",
          "match": "\\b(true|false|null)\\b"
        },
        {
          "name": "variable.language.underscore.parsley",
          "match": "\\b_\\b"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.parsley",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.parsley",
              "match": "\\\\([ntr\\\\\"'{}])"
            },
            {
              "name": "meta.embedded.line.parsley",
              "begin": "(?<!\\\\)\\{",
              "end": "\\}",
              "patterns": [
                {
                  "include": "$self"
                }
              ],
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.begin.parsley"
                }
              },
              "endCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.end.parsley"
                }
              }
            }
          ]
        }
      ]
    },
    "template-literals": {
      "patterns": [
        {
          "name": "string.template.parsley",
          "begin": "`",
          "end": "`",
          "patterns": [
            {
              "name": "constant.character.escape.parsley",
              "match": "\\\\([ntr\\\\`{}])"
            },
            {
              "name": "meta.embedded.line.parsley",
              "begin": "(?<!\\\\)\\{",
              "end": "\\}",
              "patterns": [
                {
                  "include": "$self"
                }
              ],
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.begin.parsley"
                }
              },
              "endCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.end.parsley"
                }
              }
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.parsley",
          "match": "\\b\\d+\\.\\d+\\b"
        },
        {
          "name": "constant.numeric.integer.parsley",
          "match": "\\b\\d+\\b"
        }
      ]
    },
    "regex-literals": {
      "patterns": [
        {
          "name": "string.regexp.parsley",
          "begin": "/(?![*/])",
          "end": "/[gimsuvy]*",
          "patterns": [
            {
              "name": "constant.character.escape.parsley",
              "match": "\\\\."
            }
          ],
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.parsley"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.string.end.parsley"
            }
          }
        }
      ]
    },
    "datetime-literals": {
      "patterns": [
        {
          "name": "constant.other.datetime.parsley",
          "comment": "Full datetime: @2024-11-26T14:30:00Z or with timezone offset",
          "match": "@\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}(:\\d{2})?(\\.\\d+)?(Z|[+-]\\d{2}:\\d{2})?"
        },
        {
          "name": "constant.other.date.parsley",
          "comment": "Date only: @2024-11-26",
          "match": "@\\d{4}-\\d{2}-\\d{2}(?!T)"
        },
        {
          "name": "constant.other.time.parsley",
          "comment": "Time only: @12:30 or @12:30:45",
          "match": "@\\d{1,2}:\\d{2}(:\\d{2})?"
        }
      ]
    },
    "duration-literals": {
      "patterns": [
        {
          "name": "constant.other.duration.parsley",
          "comment": "Duration: @1d, @2h30m, @1y6mo, @-1d (negative)",
          "match": "@-?\\d+[yMwdhms]([0-9yMwdhms]|mo)*"
        }
      ]
    },
    "path-template-literals": {
      "patterns": [
        {
          "name": "meta.path-template.parsley",
          "begin": "@\\(",
          "end": "\\)",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.path-template.begin.parsley"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.path-template.end.parsley"
            }
          },
          "patterns": [
            {
              "name": "meta.interpolation.parsley",
              "begin": "\\{",
              "end": "\\}",
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.interpolation.begin.parsley"
                }
              },
              "endCaptures": {
                "0": {
                  "name": "punctuation.definition.interpolation.end.parsley"
                }
              },
              "patterns": [
                {
                  "include": "#keywords"
                },
                {
                  "include": "#constants"
                },
                {
                  "include": "#strings"
                },
                {
                  "include": "#numbers"
                },
                {
                  "include": "#operators"
                }
              ]
            },
            {
              "name": "constant.other.path.parsley",
              "match": "[^{}]+"
            }
          ]
        }
      ]
    },
    "url-template-literals": {
      "patterns": [
        {
          "comment": "URL templates are handled by path-template-literals since they share the same syntax"
        }
      ]
    },
    "path-literals": {
      "patterns": [
        {
          "name": "string.unquoted.path.parsley",
          "match": "@(\\./|\\.\\./)([^\\s<>\"{}|\\\\^`\\[\\]]*)|@(/|~/)([^\\s<>\"{}|\\\\^`\\[\\]]*)",
          "captures": {
            "0": {
              "name": "constant.other.path.parsley"
            }
          }
        }
      ]
    },
    "url-literals": {
      "patterns": [
        {
          "name": "string.unquoted.url.parsley",
          "match": "@(https?|ftp|file)://[^\\s<>\"{}|\\\\^`\\[\\]]+",
          "captures": {
            "0": {
              "name": "constant.other.url.parsley"
            }
          }
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "support.function.builtin.parsley",
          "match": "\\b(import|len|map|sort|sortBy|reverse|toString|toDebug|repr|toNumber|toInt|toFloat|toUpper|toLower|log|logLine|has|keys|values|toArray|toDict|delete|sin|cos|tan|asin|acos|atan|sqrt|round|pow|pi|now|time|path|url|regex|replace|split)\\b"
        },
        {
          "name": "entity.name.function.parsley",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\\s*=\\s*fn\\b)"
        }
      ]
    },
    "tags": {
      "patterns": [
        {
          "name": "meta.tag.parsley",
          "begin": "<(/)?([A-Z][a-zA-Z0-9]*|[a-z][a-zA-Z0-9]*|>)?",
          "end": "/?>",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.tag.begin.parsley"
            },
            "1": {
              "name": "punctuation.definition.tag.slash.parsley"
            },
            "2": {
              "name": "entity.name.tag.parsley"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.tag.end.parsley"
            }
          },
          "patterns": [
            {
              "name": "entity.other.attribute-name.parsley",
              "match": "\\b[a-zA-Z][a-zA-Z0-9_-]*(?=\\s*=)"
            },
            {
              "include": "#strings"
            },
            {
              "name": "meta.embedded.expression.parsley",
              "begin": "\\{",
              "end": "\\}",
              "patterns": [
                {
                  "include": "$self"
                }
              ],
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.expression.begin.parsley"
                }
              },
              "endCaptures": {
                "0": {
                  "name": "punctuation.definition.expression.end.parsley"
                }
              }
            }
          ]
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.regex.parsley",
          "match": "(~|!~)"
        },
        {
          "name": "keyword.operator.comparison.parsley",
          "match": "(==|!=|<=|>=|<(?![a-zA-Z])|>(?![>/]))"
        },
        {
          "name": "keyword.operator.logical.parsley",
          "match": "(&&|\\|\\||!)"
        },
        {
          "name": "keyword.operator.arithmetic.parsley",
          "match": "(\\+\\+|\\+|-|\\*|/|%)"
        },
        {
          "name": "keyword.operator.assignment.parsley",
          "match": "="
        },
        {
          "name": "keyword.operator.spread.parsley",
          "match": "\\.\\.\\."
        }
      ]
    },
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.separator.comma.parsley",
          "match": ","
        },
        {
          "name": "punctuation.terminator.statement.parsley",
          "match": ";"
        },
        {
          "name": "meta.brace.square.parsley",
          "match": "[\\[\\]]"
        },
        {
          "name": "meta.brace.round.parsley",
          "match": "[\\(\\)]"
        },
        {
          "name": "meta.brace.curly.parsley",
          "match": "[\\{\\}]"
        },
        {
          "name": "punctuation.accessor.parsley",
          "match": "\\."
        },
        {
          "name": "punctuation.separator.colon.parsley",
          "match": ":"
        }
      ]
    }
  },
  "scopeName": "source.parsley"
}